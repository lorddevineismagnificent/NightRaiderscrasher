const { setOwnerConfig, getOwnerConfig, resolveOwnerNumber } = require('../lib/owner');

module.exports = {
  name: 'antispam',
  aliases: ['nospam', 'spamshield'],
  description: 'â˜£ï¸ á´…á´‡á´›á´‡á´„á´› á´€É´á´… á´‹Éªá´„á´‹ sá´˜á´€á´á´á´‡Ê€s á´¡Éªá´›Êœ 3 á´¡á´€Ê€É´ÉªÉ´É¢s',
  ownerOnly: true,
  groupOnly: true,

  async execute(sock, msg, args, { sender, groupId, botPhoneNumber, groupMetadata }) {
    try {
      const ownerNumber = botPhoneNumber ? resolveOwnerNumber(botPhoneNumber, null) : resolveOwnerNumber(sender, groupMetadata);
      const ownerConfig = getOwnerConfig(ownerNumber);
      
      if (!ownerConfig.antispamGroups) ownerConfig.antispamGroups = [];

      if (!args[0] || !['on', 'off', 'status'].includes(args[0].toLowerCase())) {
        return await sock.sendMessage(groupId, { 
          text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â˜£ï¸ á´€É´á´›Éªsá´˜á´€á´ - sá´˜á´€á´ á´‹ÉªÊŸÊŸá´‡Ê€ â˜£ï¸
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â›” ÉªÉ´á´ á´€ÊŸÉªá´… á´á´˜á´›Éªá´É´!

ğŸ“ á´œsá´€É¢á´‡:
â€¢ .á´€É´á´›Éªsá´˜á´€á´ á´É´ - á´‡É´á´€Ê™ÊŸá´‡ sá´˜á´€á´ á´‹ÉªÊŸÊŸá´‡Ê€
â€¢ .á´€É´á´›Éªsá´˜á´€á´ á´Ò“Ò“ - á´…Éªsá´€Ê™ÊŸá´‡ sá´˜á´€á´ á´‹ÉªÊŸÊŸá´‡Ê€
â€¢ .á´€É´á´›Éªsá´˜á´€á´ sá´›á´€á´›á´œs - á´„Êœá´‡á´„á´‹ sá´›á´€á´›á´œs

âš ï¸ sá´˜á´€á´á´á´‡Ê€s É¢á´‡á´› 3 á´¡á´€Ê€É´ÉªÉ´É¢s Ê™á´‡Ò“á´Ê€á´‡ á´‹Éªá´„á´‹!

ğŸ‘¿ "sá´˜á´€á´á´á´‡Ê€s á´¡ÉªÊŸÊŸ Ò“á´‡á´‡ÊŸ á´á´œÊ€ á´¡Ê€á´€á´›Êœ" â˜ ï¸
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯` 
        });
      }

      const action = args[0].toLowerCase();
      const isEnabled = ownerConfig.antispamGroups.includes(groupId);
      
      if (action === 'status') {
        const status = isEnabled ? 'âœ… á´‡É´á´€Ê™ÊŸá´‡á´…' : 'â›” á´…Éªsá´€Ê™ÊŸá´‡á´…';
        return await sock.sendMessage(groupId, { 
          text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â˜£ï¸ á´€É´á´›Éªsá´˜á´€á´ sá´›á´€á´›á´œs â˜£ï¸
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š sá´›á´€á´›á´œs: ${status}

âš ï¸ á´…á´‡á´›á´‡á´„á´›Éªá´É´:
â€¢ 8+ á´á´‡ssá´€É¢á´‡s ÉªÉ´ 10s = á´¡á´€Ê€É´ÉªÉ´É¢
â€¢ 5+ Éªá´…á´‡É´á´›Éªá´„á´€ÊŸ á´á´‡ssá´€É¢á´‡s = á´‹Éªá´„á´‹ + ÊŸá´á´„á´‹

ğŸ‘¿ "sá´˜á´€á´á´á´‡Ê€s á´¡ÉªÊŸÊŸ Ê™á´œÊ€É´" â˜ ï¸
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯` 
        });
      }
      
      if (action === 'on') {
        if (!isEnabled) {
          ownerConfig.antispamGroups.push(groupId);
        }
        setOwnerConfig(ownerNumber, { antispamGroups: ownerConfig.antispamGroups });
        await sock.sendMessage(groupId, { 
          text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â˜£ï¸ á´€É´á´›Éªsá´˜á´€á´ á´‡É´á´€Ê™ÊŸá´‡á´… â˜£ï¸
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… sá´˜á´€á´ á´‹ÉªÊŸÊŸá´‡Ê€ á´€á´„á´›Éªá´ á´€á´›á´‡á´…!

âš ï¸ á´…á´‡á´›á´‡á´„á´›Éªá´É´:
â€¢ Ê€á´€á´˜Éªá´… á´á´‡ssá´€É¢ÉªÉ´É¢ (8+/10s) = á´¡á´€Ê€É´ÉªÉ´É¢
â€¢ Éªá´…á´‡É´á´›Éªá´„á´€ÊŸ sá´˜á´€á´ (5x) = á´‹Éªá´„á´‹ + É¢Ê€á´á´œá´˜ ÊŸá´á´„á´‹

ğŸ“Š 3 á´¡á´€Ê€É´ÉªÉ´É¢s = á´‹Éªá´„á´‹

ğŸ‘¿ "sá´˜á´€á´á´á´‡Ê€s á´¡ÉªÊŸÊŸ Ò“á´‡á´‡ÊŸ á´á´œÊ€ á´¡Ê€á´€á´›Êœ" â˜ ï¸
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯` 
        });
      } else {
        ownerConfig.antispamGroups = ownerConfig.antispamGroups.filter(g => g !== groupId);
        setOwnerConfig(ownerNumber, { antispamGroups: ownerConfig.antispamGroups });
        await sock.sendMessage(groupId, { 
          text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â˜£ï¸ á´€É´á´›Éªsá´˜á´€á´ á´…Éªsá´€Ê™ÊŸá´‡á´… â˜£ï¸
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â›” sá´˜á´€á´ á´‹ÉªÊŸÊŸá´‡Ê€ á´…á´‡á´€á´„á´›Éªá´ á´€á´›á´‡á´…

ğŸ“± sá´˜á´€á´ á´˜Ê€á´á´›á´‡á´„á´›Éªá´É´ á´…Éªsá´€Ê™ÊŸá´‡á´…

ğŸ‘¿ "á´…á´‡Ò“á´‡É´sá´‡s ÊŸá´á´¡á´‡Ê€á´‡á´…" â˜ ï¸
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯` 
        });
      }
    } catch (err) {
      console.error('Antispam command error:', err);
      await sock.sendMessage(groupId, { 
        text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â›” á´‡Ê€Ê€á´Ê€ â›”
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš« Ò“á´€ÉªÊŸá´‡á´… á´›á´ á´œá´˜á´…á´€á´›á´‡ á´€É´á´›Éªsá´˜á´€á´ sá´‡á´›á´›ÉªÉ´É¢s.
ğŸ“ á´‡Ê€Ê€á´Ê€: ${err.message}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯` 
      });
    }
  }
};
